version = 1


[install]
treefmt.pkg-path = "treefmt"
nixfmt.pkg-path = "nixfmt-rfc-style"
shfmt.pkg-path = "shfmt"


[vars]

[hook]
 on-activate = '''
    export ROOT_PROJECT=$(git rev-parse --show-toplevel)
    script() {
      local name="${1:-}"
      shift || true
      if [ -z "$name" ]; then
        echo "Usage: script <name> [args...] (runs scripts/<name>.sh)" >&2
        return 1
      fi
      local project_root="${ROOT_PROJECT:-$(git rev-parse --show-toplevel 2>/dev/null || pwd)}"
      local path="$project_root/scripts/${name}.sh"
      if [ ! -x "$path" ]; then
        echo "script: $path not found or not executable" >&2
        return 1
      fi
      "$path" "$@"
    }
    # Ensure Yarn 4 shim wins over any host Yarn 1.x
    clean_path="$(printf '%s' "$PATH" | tr ':' '\n' | grep -v '/.yarn/bin' | paste -sd: -)"
    export COREPACK_HOME="$HOME/.local/share/corepack"
    mkdir -p "$HOME/.local/bin" "$COREPACK_HOME"
    export PATH="$HOME/.local/bin:$COREPACK_HOME:$clean_path"
    if command -v corepack >/dev/null 2>&1; then
      corepack enable --install-directory "$HOME/.local/bin" >/dev/null 2>&1 || true
      corepack prepare "yarn@4.12.0" --activate --install-directory "$HOME/.local/bin" >/dev/null 2>&1 || true
      hash -r
    fi
 '''


[profile]


[services]
[include]


[build]
# [build.myproject]
# description = "The coolest project ever"
# version = "0.0.1"
# command = """
#   mkdir -p $out/bin
#   cargo build --release
#   cp target/release/myproject $out/bin/myproject
# """


[options]
