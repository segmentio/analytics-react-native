{
  "$schema": "https://raw.githubusercontent.com/jetify-com/devbox/0.14.2/.schema/devbox.schema.json",
  "packages": {
    "cocoapods": {
      "version":   "latest",
      "platforms": ["x86_64-darwin", "aarch64-darwin"],
    },
    "android-tools":                                           "flake:./nix#android-sdk",
    "yarn-berry":                                              "latest",
    "jdk17":                                                   "latest",
    "gradle":                                                  "latest",
    "jq":                                                      "latest",
  },
  "shell": {
    "init_hook": [
      "echo 'Welcome to analytics-react-native devbox!' > /dev/null",
      "OS_NAME=$(uname -s)",
      "if [ \"$OS_NAME\" = \"Darwin\" ]; then SDK_ROOT_DEFAULT=\"$HOME/Library/Android/sdk\"; else SDK_ROOT_DEFAULT=\"$HOME/Android/Sdk\"; fi",
      "export ANDROID_SDK_ROOT=\"${ANDROID_SDK_ROOT:-$SDK_ROOT_DEFAULT}\"",
      "export ANDROID_HOME=\"$ANDROID_SDK_ROOT\"",
      "export PATH=\"$ANDROID_SDK_ROOT/emulator:$ANDROID_SDK_ROOT/platform-tools:$ANDROID_SDK_ROOT/cmdline-tools/latest/bin:$PATH\"",
    ],
    "scripts": {
      "clean": [
        "rm -rf $DEVBOX_PROJECT_ROOT/examples/E2E/ios/Podfile.lock",
        "rm -rf $DEVBOX_PROJECT_ROOT/examples/E2E/ios/Pods",
        "cd $DEVBOX_PROJECT_DIR/examples/E2E/android && gradle clean",
        "yarn cache clean",
        "find $DEVBOX_PROJECT_DIR -type d -name node_modules -exec rmdir {} \\;",
      ],
      "build": [
        "yarn install --immutable",
        "yarn build",
        "yarn lint",
        "yarn test --coverage",
      ],
      "test-android": [
        "yarn install",
        "yarn e2e install",
        "yarn build",
        "yarn e2e build:android",
        "yarn e2e test:android",
      ],
      "test-ios": [
        "yarn install",
        "yarn e2e install",
        "yarn e2e pods",
        "yarn build",
        "yarn e2e build:ios",
        "yarn e2e test:ios",
      ],
      "setup-android": [
        "bash $DEVBOX_PROJECT_ROOT/scripts/setup-android.sh",
      ],
      "setup-ios": [
        "bash $DEVBOX_PROJECT_ROOT/scripts/setup-ios.sh",
      ],
      "test": [
        "devbox run test-android",
        "devbox run test-ios",
      ],
    },
  },
}
